"{{ Vite::asset('resources/assets/images/Dorado Impex Logo TM Mark.png') }}"


@extends('frontend.layouts.navbarlayout')


@section('title','Blog')

@section('main')

   

@endsection


<li><a href="/applications/automotive">Automotive</a></li>
<li><a href="/applications/aerospace">Aerospace</a></li>
<li><a href="/applications/dental-industry">Dental Industry</a></li>
<li><a href="/applications/jewelry-industry">Jewelry Industry</a></li>
<li><a href="/applications/industrial-engineering">Industrial Engineering</a></li>
<li class="active"><a href="3d-printing-consumables">3D Printing Consumables</a></li>
<li><a href="/applications/additive-manufacturing">Additive Manufacturing</a></li>
<li><a href="/applications/educational-applications">Educational Applications</a></li>


 <script>
        // Enhanced AuthManager with better debugging
        class AuthManager {
            constructor() {
                this.tokenKey = 'auth_token';
                this.userKey = 'user_data';
                this.expiryKey = 'token_expiry';
                this.init();
            }

            init() {
                console.log('AuthManager initialized');
                this.checkAuthStatus();
                this.setupLogoutHandler();
                this.startTokenChecker();
            }

            // Store auth data in localStorage
            storeAuthData(token, user, expiresIn) {
                const expiryTime = Date.now() + (expiresIn * 1000);
                
                localStorage.setItem(this.tokenKey, token);
                localStorage.setItem(this.userKey, JSON.stringify(user));
                localStorage.setItem(this.expiryKey, expiryTime.toString());
                
                console.log('‚úÖ Auth data stored in localStorage:', {
                    token: token ? 'Yes' : 'No',
                    user: user ? user.name : 'No',
                    role: user ? user.role : 'No',
                    expiresIn: expiresIn
                });
                
                this.updateUI();
            }

            // Get stored token
            getToken() {
                return localStorage.getItem(this.tokenKey);
            }

            // Get stored user data
            getUser() {
                try {
                    const userData = localStorage.getItem(this.userKey);
                    const user = userData ? JSON.parse(userData) : null;
                    console.log('üìã Retrieved user from localStorage:', user);
                    return user;
                } catch (e) {
                    console.error('‚ùå Error parsing user data:', e);
                    return null;
                }
            }

            // Check if token is valid
            isTokenValid() {
                const token = this.getToken();
                const expiry = localStorage.getItem(this.expiryKey);
                
                console.log('üîç Token validation check:', {
                    hasToken: !!token,
                    hasExpiry: !!expiry,
                    expiryTime: expiry ? new Date(parseInt(expiry)).toISOString() : 'None'
                });
                
                if (!token || !expiry) {
                    console.log('‚ùå No token or expiry found');
                    return false;
                }
                
                const isValid = Date.now() < parseInt(expiry);
                console.log('üîê Token valid:', isValid, 'Time left:', this.formatTimeRemaining());
                return isValid;
            }

            // Check auth status and update UI
            async checkAuthStatus() {
                console.log('üîÑ Checking auth status...');
                
                if (this.isTokenValid()) {
                    console.log('‚úÖ User is logged in');
                    this.updateUI();
                } else {
                    console.log('‚ùå User is not logged in');
                    this.clearAuthData();
                    this.showLoginRegister();
                }
            }

            // Update UI based on auth status
            updateUI() {
                const user = this.getUser();
                const registerItem = document.getElementById('register-item');
                const loginItem = document.getElementById('login-item');
                const userInfoItem = document.getElementById('user-info-item');
                const logoutItem = document.getElementById('logout-item');
                const userName = document.getElementById('user-name');

                console.log('üé® Updating UI, user data:', user);

                if (user && this.isTokenValid()) {
                    // User is logged in
                    if (registerItem) registerItem.classList.add('d-none');
                    if (loginItem) loginItem.classList.add('d-none');
                    if (userInfoItem) userInfoItem.classList.remove('d-none');
                    if (logoutItem) logoutItem.classList.remove('d-none');
                    if (userName) userName.textContent = user.name;
                    
                    console.log('‚úÖ UI updated: Showing user menu for', user.name);
                } else {
                    // User is not logged in
                    console.log('üîÑ UI updated: Showing login/register');
                    this.showLoginRegister();
                }
            }

            // Show login/register links
            showLoginRegister() {
                const registerItem = document.getElementById('register-item');
                const loginItem = document.getElementById('login-item');
                const userInfoItem = document.getElementById('user-info-item');
                const logoutItem = document.getElementById('logout-item');

                if (registerItem) registerItem.classList.remove('d-none');
                if (loginItem) loginItem.classList.remove('d-none');
                if (userInfoItem) userInfoItem.classList.add('d-none');
                if (logoutItem) logoutItem.classList.add('d-none');
                
                console.log('üë§ Showing login/register links');
            }

            // Clear auth data from localStorage
            clearAuthData() {
                localStorage.removeItem(this.tokenKey);
                localStorage.removeItem(this.userKey);
                localStorage.removeItem(this.expiryKey);
                console.log('üóëÔ∏è Auth data cleared from localStorage');
                this.updateUI();
            }

            // Setup logout handler
            setupLogoutHandler() {
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'logout-btn' || e.target.closest('#logout-btn')) {
                        e.preventDefault();
                        this.logout();
                    }
                });
            }

            // Logout function
            async logout() {
                try {
                    const token = this.getToken();
                    
                    if (token) {
                        await fetch('/logout', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`,
                                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
                            },
                            body: JSON.stringify({ force_logout: true })
                        });
                    }
                } catch (error) {
                    console.error('Logout API error:', error);
                } finally {
                    this.clearAuthData();
                    alert('You have been logged out successfully!');
                    window.location.href = '/';
                }
            }

            // Start periodic token checker
            startTokenChecker() {
                setInterval(() => {
                    this.checkAuthStatus();
                }, 30000);
            }

            // Format time remaining
            formatTimeRemaining() {
                const expiry = localStorage.getItem(this.expiryKey);
                if (!expiry) return 'No token';
                
                const timeLeft = parseInt(expiry) - Date.now();
                if (timeLeft <= 0) return 'Expired';
                
                const minutes = Math.floor(timeLeft / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                return `${minutes}m ${seconds}s`;
            }
        }

        // Initialize auth manager when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM loaded, initializing AuthManager...');
            window.authManager = new AuthManager();
            
            // Check if already logged in and redirect from auth pages
            const token = localStorage.getItem('auth_token');
            const userData = localStorage.getItem('user_data');
            const expiry = localStorage.getItem('token_expiry');
            
            if (token && userData && expiry && Date.now() < parseInt(expiry)) {
                const currentPath = window.location.pathname;
                console.log('üìç Current path:', currentPath);
                
                // Redirect if trying to access login/register while logged in
                if (currentPath === '/signin' || currentPath === '/signup') {
                    console.log('üîÑ Redirecting to home from auth page');
                    window.location.href = '/';
                }
            }
        });

        // Global login success handler
        async function handleLoginSuccess(responseData) {
            console.log('üéâ Global login success handler called:', responseData);
            
            if (responseData.token && responseData.user) {
                console.log('üì¶ Storing auth data:', {
                    token: responseData.token ? 'Yes' : 'No',
                    user: responseData.user ? responseData.user.name : 'No',
                    role: responseData.user ? responseData.user.role : 'No',
                    expiresIn: responseData.expires_in
                });
                
                // Store auth data
                if (window.authManager) {
                    window.authManager.storeAuthData(
                        responseData.token,
                        responseData.user,
                        responseData.expires_in || 300
                    );
                } else {
                    // Fallback storage
                    localStorage.setItem('auth_token', responseData.token);
                    localStorage.setItem('user_data', JSON.stringify(responseData.user));
                    localStorage.setItem('token_expiry', (Date.now() + (responseData.expires_in || 300) * 1000).toString());
                }
                
                // Show welcome message
                alert('Welcome back, ' + responseData.user.name + '!');
                
                // Redirect after short delay
                setTimeout(() => {
                    console.log('üîÑ Redirecting to:', responseData.redirect || '/');
                    window.location.href = responseData.redirect || '/';
                }, 500);
            } else {
                console.error('‚ùå Invalid response data:', responseData);
            }
        }

        // Global register success handler  
        async function handleRegisterSuccess(responseData) {
            console.log('üéâ Global register success handler called:', responseData);
            
            if (responseData.token && responseData.user) {
                if (window.authManager) {
                    window.authManager.storeAuthData(
                        responseData.token,
                        responseData.user,
                        responseData.expires_in || 300
                    );
                }
                
                alert('Welcome to DoradoImpex, ' + responseData.user.name + '!');
                
                setTimeout(() => {
                    window.location.href = responseData.redirect || '/';
                }, 500);
            }
        }

        // Auto-logout when token expires
        function startAutoLogoutTimer() {
            const expiry = localStorage.getItem('token_expiry');
            if (!expiry) return;

            const timeUntilExpiry = parseInt(expiry) - Date.now();
            
            if (timeUntilExpiry > 0) {
                console.log('‚è∞ Auto-logout timer set for:', timeUntilExpiry + 1000, 'ms');
                setTimeout(async () => {
                    console.log('üîî Auto-logout timer triggered');
                    if (window.authManager) {
                        await window.authManager.checkAuthStatus();
                    }
                }, timeUntilExpiry + 1000);
            }
        }

        // Start auto-logout timer
        document.addEventListener('DOMContentLoaded', startAutoLogoutTimer);
    </script>



 <script>
document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.innerHTML = 'Signing in...';
    submitBtn.disabled = true;
    
    console.log('üì§ Sending login request...');
    
    try {
        const response = await fetch('{{ route("login.submit") }}', {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Accept': 'application/json',
                'X-CSRF-TOKEN': '{{ csrf_token() }}'
            },
            body: formData
        });
        
        const data = await response.json();
        
        console.log('üì• Login response:', data);
        
        if (data.success) {
            console.log('‚úÖ Login successful, calling handleLoginSuccess');
            
            // Use the global function to handle success
            if (typeof handleLoginSuccess === 'function') {
                handleLoginSuccess(data);
            } else {
                console.log('‚ö†Ô∏è handleLoginSuccess not found, using fallback');
                // Fallback: store directly and redirect
                localStorage.setItem('auth_token', data.token);
                localStorage.setItem('user_data', JSON.stringify(data.user));
                localStorage.setItem('token_expiry', (data.expires_at * 1000).toString());
                
                alert('Login successful! Welcome back, ' + data.user.name);
                window.location.href = data.redirect || '/';
            }
            
        } else {
            console.log('‚ùå Login failed:', data.message);
            alert(data.message || 'Login failed. Please check your credentials.');
        }
    } catch (error) {
        console.error('üí• Login error:', error);
        alert('An error occurred during login. Please try again.');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
 </script>




<script>
document.getElementById('register-Form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.innerHTML = 'Creating Account...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch('{{ route("register.submit") }}', {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Accept': 'application/json',
                'X-CSRF-TOKEN': '{{ csrf_token() }}'
            },
            body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
            // Use the global function to handle success
            if (typeof handleRegisterSuccess === 'function') {
                handleRegisterSuccess(data);
            } else {
                // Fallback: store directly and redirect
                localStorage.setItem('auth_token', data.token);
                localStorage.setItem('user_data', JSON.stringify(data.user));
                localStorage.setItem('token_expiry', (data.expires_at * 1000).toString());
                window.location.href = data.redirect || '/';
            }
            
            // Show success message
            alert('Registration successful! Welcome, ' + data.user.name);
            
        } else {
            // Show validation errors
            if (data.errors) {
                let errorMessage = '';
                for (const field in data.errors) {
                    errorMessage += data.errors[field].join('\n') + '\n';
                }
                alert(errorMessage.trim());
            } else {
                alert(data.message || 'Registration failed');
            }
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred during registration. Please try again.');
    } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});
</script>